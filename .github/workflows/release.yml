name: Release
on: [push]

jobs:
  create-release:
    name: Build and Create Tagged release
    runs-on: ubuntu-latest
    steps:
      - name: Install archive tools
        run: sudo apt install zip

      - name: Checkout source code
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
          ref: ${{ github.event.repository.default_branch }}
 
      - name: Setup node
        uses: actions/setup-node@v2
        with:
          node-version: 22.x

      - name: Install Dependencies
        run: npm ci
        working-directory: web

      - name: Run build
        run: npm run build
        working-directory: web
        env:
          CI: false

      - name: Bundle files
        run: |
          mkdir -p ./temp/animations_dev
          mkdir -p ./temp/animations_dev/web
          cp ./{README.md,fxmanifest.lua} ./temp/animations_dev
          cp -r ./web/dist ./temp/animations_dev/web/dist
          cd ./temp && zip -r ../animations_dev.zip ./animations_dev
          
      - name: Upload Release Asset
        uses: softprops/action-gh-release@v2
        with:
          files: animations_dev.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
